<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <!-- sale.order.claim search view -->
        <record model="ir.ui.view" id="view_sale_order_claim_search">
            <field name="name">sale.order.claim.search</field>
            <field name="model">sale.order.claim</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search sale order claims">
                    <group col="10" colspan="5">
                        <field name="sale_order_id" />
                        <field name="merchandiser_id" />
                        <field name="create_uid" />
                        <field name="customer_id" />
                        <field name="state" />
                    </group>
                    <newline />
                    <group expand="0" string="Group by..." colspan="4" col="4" groups="base.group_extended">
                        <filter string="Shop" icon="terp-stage" domain="[]" context="{'group_by': 'shop_id'}" />
                        <filter string="Category" icon="terp-stage" domain="[]" context="{'group_by': 'category'}" />
                    </group>
                </search>
            </field>
        </record>

        <!-- sale.order.claim tree view; although the model inherits
             from crm.claim, this tree view will not inherit from
             crm.claim's tree view -->
        <record model="ir.ui.view" id="view_sale_order_claim_tree">
            <field name="name">sale.order.claim.tree</field>
            <field name="model">sale.order.claim</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Sale Order Claims" colors="blue:state=='pending'">
                    <field name="name"
                           string="Claim" />
                    <field name="sale_order_id" />
                    <field name="customer_id" />
                    <field name="order_total" />
                    <field name="category" />
                    <field name="reason" />
                    <field name="state" />
                    <!--
                        These break the Web client; the named functions don't exist; but also, we need to think more about the stages anyway
                    <button name="claim_confirm"
                            string="Confirm"
                            states="draft"
                            type="object"
                            icon="gtk-go-forward" />
                    <button name="claim_process"
                            string="Process"
                            states="review,confirmed"
                            type="object"
                            icon="gtk-go-forward" />
                    <button name="claim_review"
                            string="Review"
                            states="processing"
                            type="object"
                            icon="gtk-media-pause" />
                    <button name="claim_approve"
                            string="Approve"
                            states="processing"
                            type="object"
                            icon="gtk-ok" />
                    -->
                </tree>
            </field>
        </record>

        <!-- sale.order.claim form view; although the model inherits
             from crm.claim, this form view will not inherit from
             crm.claim's form views -->
        <record model="ir.ui.view" id="view_sale_order_claim_form">
            <field name="name">sale.order.claim.form</field>
            <field name="model">sale.order.claim</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form>
                    <field name="name"
                           string="Claim" />
                    <field name="create_uid" />
                    <field name="create_date" />
                    <field name="write_uid" />
                    <field name="write_date" />
                    <field name="sale_order_id" />
                    <field name="shop_id" />
                    <field name="origin" />
                    <field name="client_order_ref" />
                    <field name="order_state" />
                    <field name="date_order" />
                    <field name="merchandiser_id" />
                    <field name="customer_id" />
                    <field name="partner_shipping_id" />
                    <field name="shipped" />
                    <field name="invoiced" />
                    <field name="order_total" />
                    <field name="category" />
                    <field name="reason" />
                    <field name="resolution" />
                    <field name="description"
                           string="Comments"
                           required="True" />
                    <field name="whole_order_claim" />
                    <field name="order_issue_ids" nolabel="1" select="1">
                        <tree>
                            <!--
                            <field name="claim_id"
                                   attrs="{'invisible':True}"
                                   required="False" />
                            -->
                            <field name="name" />
                            <field name="resource" />
                            <field name="category" />
                            <field name="reason"
                                   domain="[('parent_categ_id','=','category')]" />
                            <!--<field name="resolution" />-->
                            <field name="product" />
                            <field name="product_qty" />
                            <field name="price_unit" />
                            <field name="move_state" />
                        </tree>
                    </field>
                </form>
            </field>
        </record>

        <!-- Actions for sale.order.claim views -->

        <record id="action_sale_order_claim_tree" model="ir.actions.act_window">
            <field name="name">Sale Order Claim</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order.claim</field>
            <field name="view_type">tree</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_sale_order_claim_tree" />
            <field name="search_view_id" ref="view_sale_order_claim_search" />
        </record>

        <record id="action_sale_order_claim_form" model="ir.actions.act_window">
            <field name="name">Sale Order Claims</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order.claim</field>
            <field name="view_type">form</field>
            <field name="view_mode">form</field>
            <field name="view_id" ref="view_sale_order_claim_form" />
            <field name="search_view_id" ref="view_sale_order_claim_search" />
        </record>

        <!-- Menu for sale.order.claim views -->

        <menuitem
            action="action_sale_order_claim_tree"
            id="menu_sale_order_claim"
            parent="base.menu_aftersale" />

    </data>
</openerp>
